{"version":3,"sources":["../src/index.js"],"names":["Emitter","event","listener","_eventCollection","push","self","fn","off","apply","arguments","on","listeners","forEach","i","splice","length","args","slice","Lodash","object","path","replace","split","reduce","o","k","_","Client","url","_url","_event","_connected","_ws","connect","bind","Promise","resolve","reject","ws","WebSocket","onopen","emit","onmessage","reponse","message","data","toJSON","action","get","payload","onerror","onclose","cb","name","send","id","autoId","JSON","stringify","parse","err","console","log","len","Math","random","toString","substr","window","onload","client","then","catch","createTopic"],"mappings":"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","file":"index.js","sourcesContent":["class Emitter {\n\n   \n    on(event, listener) {\n        // Use the current collection or create it.\n        this._eventCollection = this._eventCollection || {};\n\n        // Use the current collection of an event or create it.\n        this._eventCollection[event] = this._eventCollection[event] || [];\n\n        // Appends the listener into the collection of the given event\n        this._eventCollection[event].push(listener);\n\n        return this;\n    }\n\n    \n    once(event, listener) {\n        const self = this;\n\n        function fn() {\n            self.off(event, fn);\n            listener.apply(this, arguments);\n        }\n\n        fn.listener = listener;\n\n        this.on(event, fn);\n\n        return this;\n    }\n\n    \n    off(event, listener) {\n\n        let listeners;\n\n        // Defines listeners value.\n        if (!this._eventCollection || !(listeners = this._eventCollection[event])) {\n            return this;\n        }\n\n        listeners.forEach((fn, i) => {\n            if (fn === listener || fn.listener === listener) {\n                // Removes the given listener.\n                listeners.splice(i, 1);\n            }\n        });\n\n        // Removes an empty event collection.\n        if (listeners.length === 0) {\n            delete this._eventCollection[event];\n        }\n\n        return this;\n    }\n\n    \n    emit(event, ...args) {\n        let listeners;\n\n        // Defines listeners value.\n        if (!this._eventCollection || !(listeners = this._eventCollection[event])) {\n            return this;\n        }\n\n        // Clone listeners\n        listeners = listeners.slice(0);\n\n        listeners.forEach(fn => fn.apply(this, args));\n\n        return this;\n    }\n\n}\n\n\n\nclass Lodash {\n\n\tget(object, path){\n\t\treturn path.\n        replace(/\\[/g, '.').\n        replace(/\\]/g, '').\n        split('.').\n        reduce((o, k) => (o || {})[k], object);\n\t}\n}\n\nconst _ = new Lodash();\n\n\nclass Client{\n\n\tconstructor(url){\n\n\t\tthis._url = url;\n\t\tthis._event = new Emitter();\n\t\tthis._connected = false;\n\t\tthis._ws = null;\n\n\n\t\tthis.connect = this.connect.bind(this);\n\t\tthis._event.on('disconnect', () => {\n\t\t\tthis.connect();\n\t\t});\n\t}\n\n\t\n\tconnect(){\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tconst ws = new WebSocket(this._url);\n\t\t\tthis._ws = ws;\n\n\t\t\tws.onopen = () => {\n\n\t\t\t\tthis._connected = true;\n\t\t\t\tthis._event.emit('connected', true);\n\n\n\n\n\t\t\t\tresolve(this);\n\n\n\n\t\t\t}\n\n\t\t\tws.onmessage = (reponse) => {\n\t\t\t\t\n\n\t\t\t\t\tlet message = reponse.data;\n\n\t\t\t\t\tif(typeof message === 'string'){\n\n\t\t\t\t\t\tmessage = this.toJSON(message);\n\n\t\t\t\t\t\tconst action = _.get(message, 'action');\n\t\t\t\t\t\tconst payload = _.get(message, 'payload');\n\n\t\t\t\t\t\t\n\n\t\t\t\t\t\tswitch(action){\n\n\t\t\t\t\t\t\tcase '__reply__':\n\n\t\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\t\tthis._event.emit(`__reply__${payload}`, true);\n\n\t\t\t\t\t\t\t\tbreak;\n\n\n\t\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t};\n\n\n\t\t\tws.onerror = () => {\n\n\t\t\t\tthis._connected = false;\n\t\t\t\tthis._event.emit('disconnect', true);\n\n\t\t\t\treject(\"Can not connect to the server.\");\n\t\t\t}\n\t\t\tws.onclose = () => {\n\n\t\t\t\tthis._event.emit('disconnect', true);\n\t\t\t\tthis._connected = false;\n\t\t\t\treject(\"Closed\");\n\t\t\t}\n\n\t\t\n\n\t\t})\n\t\n\t}\n\n\ton(event, cb = () => {}){\n\t\tthis._event.on(event, cb);\n\t}\n\n\tcreateTopic(name){\n\n\t\treturn this.send({\n\t\t\tid: this.autoId(),\n\t\t\taction: 'topic',\n\t\t\tpayload: name,\n\t\t});\n\n\t}\n\n\tsend(message){\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tif(this._connected){\n\t\t\t\tthis._ws.send(JSON.stringify(message));\n\t\t\t\tconst cb = resolve;\n\t\t\t\tthis.on(`__reply__${_.get(message, 'id')}`, cb);\n\n\t\t\t}else{\n\n\t\t\t\treturn reject(\"You are not connected\");\n\t\t\t}\n\t\t});\n\t}\n\ttoJSON(message){\n\n\t\ttry{\n\t\t\tmessage = JSON.parse(message);\n\t\t}\n\t\tcatch(err){\n\t\t\tconsole.log(err);\n\t\t}\n\t\treturn message;\n\t}\n\n\t\n\tautoId(len = 40){\n\t\treturn Math.random().toString(36).substr(2, 5);\n\t}\n}\n\n\nwindow.onload = (function(){\n\n\tconst client = new Client('ws://localhost:3001/');\n\n\tclient.connect().then(() => {\n\t\tconsole.log(\"Client is connected\");\n\t}).catch(err => {\n\n\t\tconsole.log(\"An error connecting\", err);\n\t});\n\n\tclient.on('connected', () => {\n\t\tconsole.log(\"you are connected\");\n\n\t\t\tclient.createTopic('toan').then(() => {\n\n\t\t\tconsole.log(\"Your topic has created\");\n\n\t\t})\n\t})\n\n\t\n});"]}